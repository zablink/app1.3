generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model ShopSubscription {
  id                       String                @id @default(dbgenerated("(gen_random_uuid())::text"))
  shop_id                  String
  package_id               String
  start_date               DateTime              @db.Date
  end_date                 DateTime              @db.Date
  status                   subscription_status?  @default(ACTIVE)
  original_price           Decimal               @db.Decimal(10, 2)
  discount_amount          Decimal?              @default(0) @db.Decimal(10, 2)
  final_price              Decimal               @db.Decimal(10, 2)
  payment_status           String?               @default("PENDING")
  paid_at                  DateTime?             @db.Timestamptz(6)
  auto_renew               Boolean?              @default(true)
  cancelled_at             DateTime?             @db.Timestamptz(6)
  cancellation_reason      String?
  parent_subscription_id   String?
  renewal_count            Int?                  @default(1)
  created_at               DateTime?             @default(now()) @db.Timestamptz(6)
  updated_at               DateTime?             @default(now()) @db.Timestamptz(6)
  subscription_packages    subscription_packages @relation(fields: [package_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  shop_subscriptions       ShopSubscription?     @relation("shop_subscriptionsToshop_subscriptions", fields: [parent_subscription_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  other_shop_subscriptions ShopSubscription[]    @relation("shop_subscriptionsToshop_subscriptions")
  Shop                     Shop                  @relation(fields: [shop_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([start_date, end_date], map: "shop_subscriptions_dates_idx")
  @@index([package_id], map: "shop_subscriptions_package_idx")
  @@index([shop_id], map: "shop_subscriptions_shop_idx")
  @@index([status])
  @@map("shop_subscriptions")
}

model loc_geographies {
  id            Int             @id
  name          String
  loc_provinces loc_provinces[]

  @@map("loc_geographies")
}

model loc_provinces {
  id              Int             @id
  name_th         String
  name_en         String
  geography_id    Int
  created_at      DateTime?       @db.Timestamp(6)
  updated_at      DateTime?       @db.Timestamp(6)
  deleted_at      DateTime?       @db.Timestamp(6)
  loc_amphures    loc_amphures[]
  loc_geographies loc_geographies @relation(fields: [geography_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@map("loc_provinces")
}

model loc_amphures {
  id            Int           @id
  name_th       String
  name_en       String
  province_id   Int
  created_at    DateTime?     @db.Timestamp(6)
  updated_at    DateTime?     @db.Timestamp(6)
  deleted_at    DateTime?     @db.Timestamp(6)
  loc_provinces loc_provinces @relation(fields: [province_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  loc_tambons   loc_tambons[]

  @@map("loc_amphures")
}

model loc_tambons {
  id           Int                      @id
  zip_code     String?
  name_th      String
  name_en      String
  amphure_id   Int
  created_at   DateTime?                @db.Timestamp(6)
  updated_at   DateTime?                @db.Timestamp(6)
  deleted_at   DateTime?                @db.Timestamp(6)
  geom         Unsupported("geometry")?
  loc_amphures loc_amphures             @relation(fields: [amphure_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([geom], map: "geom_idx", type: Gist)
  @@map("loc_tambons")
}

model shop_daily_hours {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  shop_id      String
  day_of_week  Int
  is_closed    Boolean   @default(false)
  open_time    DateTime? @db.Time(6)
  close_time   DateTime? @db.Time(6)
  open_time_2  DateTime? @db.Time(6)
  close_time_2 DateTime? @db.Time(6)
  created_at   DateTime  @default(now()) @db.Timestamptz(6)
  Shop         Shop      @relation(fields: [shop_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([shop_id, day_of_week], map: "shop_daily_hours_unique")
  @@index([day_of_week], map: "shop_daily_hours_day_idx")
  @@index([shop_id])
  @@map("shop_daily_hours")
}

model shop_gallery {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  shop_id     String
  image_url   String
  is_featured Boolean   @default(false)
  uploaded_at DateTime? @default(now()) @db.Timestamptz(6)
  Shop        Shop      @relation(fields: [shop_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("shop_gallery")
}

model shop_hours {
  id                 String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  shop_id            String    @unique
  is_24_hours        Boolean   @default(false)
  is_same_daily      Boolean   @default(true)
  is_closed          Boolean   @default(false)
  default_open_time  DateTime? @db.Time(6)
  default_close_time DateTime? @db.Time(6)
  created_at         DateTime  @default(now()) @db.Timestamptz(6)
  updated_at         DateTime  @default(now()) @db.Timestamptz(6)
  Shop               Shop      @relation(fields: [shop_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([shop_id])
  @@map("shop_hours")
}

model shop_links {
  id      String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  shop_id String
  type    String
  url     String
  Shop    Shop   @relation(fields: [shop_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("shop_links")
}

model shop_reviews {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  shop_id     String
  user_id     String?
  rating      Int       @db.SmallInt
  comment     String?
  is_disabled Boolean   @default(false)
  created_at  DateTime? @default(now()) @db.Timestamptz(6)
  Shop        Shop      @relation(fields: [shop_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("shop_reviews")
}

model shop_special_hours {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  shop_id      String
  special_date DateTime  @db.Date
  is_closed    Boolean   @default(false)
  reason       String?
  open_time    DateTime? @db.Time(6)
  close_time   DateTime? @db.Time(6)
  created_at   DateTime  @default(now()) @db.Timestamptz(6)
  Shop         Shop      @relation(fields: [shop_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([shop_id, special_date], map: "shop_special_hours_unique")
  @@index([special_date], map: "shop_special_hours_date_idx")
  @@index([shop_id])
  @@map("shop_special_hours")
}

model shop_stats {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  shop_id    String
  event_type String
  user_id    String?
  session_id String?
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  Shop       Shop      @relation(fields: [shop_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("shop_stats")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model Account {
  id                String  @id
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id])

  @@unique([provider, providerAccountId])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model AdPackage {
  id        String   @id
  name      String
  scope     AdScope
  priority  Int
  price     Float    @default(0.0)
  createdAt DateTime @default(now())
  updatedAt DateTime
  Shop      Shop[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model Analytics {
  id     String   @id
  shopId String
  date   DateTime @default(now())
  views  Int      @default(0)
  clicks Int      @default(0)
  Shop   Shop     @relation(fields: [shopId], references: [id])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model Menu {
  id        String   @id
  name      String
  price     Float
  image     String?
  shopId    String
  createdAt DateTime @default(now())
  updatedAt DateTime
  Shop      Shop     @relation(fields: [shopId], references: [id])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model Session {
  id           String   @id
  sessionToken String   @unique
  userId       String
  expires      DateTime
  User         User     @relation(fields: [userId], references: [id])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model Shop {
  id                   String                   @id
  ownerId              String
  name                 String
  description          String?
  createdAt            DateTime                 @default(now())
  updatedAt            DateTime
  adPackageId          String?
  address              String?
  categoryId           String
  image                String?
  location             Unsupported("geometry")?
  has_physical_store   Boolean                  @default(false)
  show_location_on_map Boolean                  @default(false)
  Analytics            Analytics[]
  Menu                 Menu[]
  AdPackage            AdPackage?               @relation(fields: [adPackageId], references: [id])
  ShopCategory         ShopCategory             @relation(fields: [categoryId], references: [id])
  User                 User                     @relation(fields: [ownerId], references: [id])
  shop_daily_hours     shop_daily_hours[]
  shop_gallery         shop_gallery[]
  shop_hours           shop_hours?
  links                shop_links[]
  shop_reviews         shop_reviews[]
  shop_special_hours   shop_special_hours[]
  shop_stats           shop_stats[]
  shop_subscriptions   ShopSubscription[]

  @@index([location], map: "shops_location_gix", type: Gist)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model ShopCategory {
  id        String   @id
  name      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime
  Shop      Shop[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model User {
  id        String    @id
  email     String?   @unique
  name      String?
  createdAt DateTime  @default(now())
  image     String?
  password  String?
  role      Role      @default(USER)
  updatedAt DateTime
  Account   Account[]
  Session   Session[]
  Shop      Shop[]
}

model banners {
  id         Int       @id @default(autoincrement())
  image      String
  link       String?
  order      Int?      @default(0)
  is_active  Boolean?  @default(true)
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  updated_at DateTime? @default(now()) @db.Timestamptz(6)

  @@index([order])
}

model simple_shops {
  id          Int       @id @default(autoincrement())
  name        String
  category    String?
  image       String?
  lat         Float?
  lng         Float?
  subdistrict String?
  district    String?
  province    String?
  created_at  DateTime? @default(now()) @db.Timestamptz(6)
  updated_at  DateTime? @default(now()) @db.Timestamptz(6)

  @@index([category])
  @@index([province])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model spatial_ref_sys {
  srid      Int     @id
  auth_name String? @db.VarChar(256)
  auth_srid Int?
  srtext    String? @db.VarChar(2048)
  proj4text String? @db.VarChar(2048)
}

model subscription_packages {
  id                         String             @id @default(dbgenerated("(gen_random_uuid())::text"))
  tier                       subscription_tier  @unique
  name                       String
  price_monthly              Decimal            @db.Decimal(10, 2)
  display_order              Int
  display_weight             Int
  badge_text                 String?
  badge_emoji                String?
  max_images                 Int?               @default(1)
  max_menu_items             Int?               @default(5)
  max_delivery_links         Int?               @default(1)
  max_promotions             Int?               @default(0)
  analytics_retention_days   Int?               @default(0)
  has_advanced_analytics     Boolean?           @default(false)
  can_pin_on_map             Boolean?           @default(false)
  can_reply_reviews          Boolean?           @default(false)
  can_set_special_hours      Boolean?           @default(false)
  can_create_coupons         Boolean?           @default(false)
  has_verified_badge         Boolean?           @default(false)
  has_social_integration     Boolean?           @default(false)
  monthly_commission_tokens  Int?               @default(0)
  banner_ad_discount_percent Decimal?           @default(0) @db.Decimal(5, 2)
  support_level              String?            @default("EMAIL")
  is_active                  Boolean?           @default(true)
  created_at                 DateTime?          @default(now()) @db.Timestamptz(6)
  updated_at                 DateTime?          @default(now()) @db.Timestamptz(6)
  shop_subscriptions         ShopSubscription[]
}

enum Role {
  USER
  SHOP
  CREATOR
  MCN_MANAGER
  AD_MANAGER
  ADMIN
}

enum ShopStatus {
  PENDING
  APPROVED
  REJECTED
  SUSPENDED
}

enum CreatorStatus {
  PENDING
  ACTIVE
  SUSPENDED
  REJECTED
}

enum PackageType {
  FREE
  PRO1
  PRO2
  SPECIAL
}

enum AdScope {
  SUBDISTRICT
  DISTRICT
  PROVINCE
  NATIONWIDE
}

enum CreatorTier {
  BRONZE
  SILVER
  GOLD
  PLATINUM
}

enum ReviewStatus {
  PENDING
  ACCEPTED
  IN_PROGRESS
  SUBMITTED
  COMPLETED
  REJECTED
  CANCELLED
}

enum WithdrawalStatus {
  PENDING
  PROCESSING
  COMPLETED
  REJECTED
}

enum subscription_status {
  ACTIVE
  EXPIRED
  CANCELLED
  SUSPENDED
}

enum subscription_tier {
  FREE
  BASIC
  PRO
  PREMIUM
}
